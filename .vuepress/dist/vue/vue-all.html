<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>思维发散 | vue知识汇总</title>
    <meta name="description" content="努力前行,温故而知新">
    <meta httpEquiv="pragma" content="no-cache">
  <meta httpEquiv="Cache-Control" content="no-cache">
  <meta name="keywords" content="前端基础,前端进阶,思维导图,javascript,react,vue">
  <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/185.styles.15a58fe7.css" as="style"><link rel="preload" href="/assets/js/app.6f74513f.js" as="script"><link rel="preload" href="/assets/js/31.f2b58b01.js" as="script"><link rel="prefetch" href="/assets/js/85.7dba617a.js"><link rel="prefetch" href="/assets/js/0.de4c5cb9.js"><link rel="prefetch" href="/assets/js/1.aafd88fb.js"><link rel="prefetch" href="/assets/js/2.e18c1574.js"><link rel="prefetch" href="/assets/js/3.a212f098.js"><link rel="prefetch" href="/assets/js/4.7fee04f2.js"><link rel="prefetch" href="/assets/js/5.f126e8e6.js"><link rel="prefetch" href="/assets/js/6.865c06f4.js"><link rel="prefetch" href="/assets/js/7.d230886e.js"><link rel="prefetch" href="/assets/js/8.fbba557d.js"><link rel="prefetch" href="/assets/js/9.d9950a97.js"><link rel="prefetch" href="/assets/js/10.d391b1ae.js"><link rel="prefetch" href="/assets/js/11.f53ea787.js"><link rel="prefetch" href="/assets/js/12.8876c6c2.js"><link rel="prefetch" href="/assets/js/13.768076b6.js"><link rel="prefetch" href="/assets/js/14.86bc2a8d.js"><link rel="prefetch" href="/assets/js/15.84f0efd4.js"><link rel="prefetch" href="/assets/js/16.a55422a0.js"><link rel="prefetch" href="/assets/js/17.ee994af8.js"><link rel="prefetch" href="/assets/js/18.51fc2dae.js"><link rel="prefetch" href="/assets/js/19.25bb4403.js"><link rel="prefetch" href="/assets/js/20.8bf0bd81.js"><link rel="prefetch" href="/assets/js/21.e34bbb46.js"><link rel="prefetch" href="/assets/js/22.e0134651.js"><link rel="prefetch" href="/assets/js/23.ec3b488b.js"><link rel="prefetch" href="/assets/js/24.a3be8f2d.js"><link rel="prefetch" href="/assets/js/25.84836d2d.js"><link rel="prefetch" href="/assets/js/26.f796c414.js"><link rel="prefetch" href="/assets/js/27.36ef3e5b.js"><link rel="prefetch" href="/assets/js/28.fc529d56.js"><link rel="prefetch" href="/assets/js/29.e44a49ca.js"><link rel="prefetch" href="/assets/js/30.c98a771b.js"><link rel="prefetch" href="/assets/js/32.cbd7e22f.js"><link rel="prefetch" href="/assets/js/33.9eec936a.js"><link rel="prefetch" href="/assets/js/34.a312b1a9.js"><link rel="prefetch" href="/assets/js/35.2c1be0f5.js"><link rel="prefetch" href="/assets/js/36.34302d24.js"><link rel="prefetch" href="/assets/js/37.5ec7c03b.js"><link rel="prefetch" href="/assets/js/38.de01b28d.js"><link rel="prefetch" href="/assets/js/39.d95168b8.js"><link rel="prefetch" href="/assets/js/40.8d0d23b5.js"><link rel="prefetch" href="/assets/js/41.6246ed59.js"><link rel="prefetch" href="/assets/js/42.94cbe7bc.js"><link rel="prefetch" href="/assets/js/43.20ce9965.js"><link rel="prefetch" href="/assets/js/44.ccadc0c7.js"><link rel="prefetch" href="/assets/js/45.9083f405.js"><link rel="prefetch" href="/assets/js/46.dca499a4.js"><link rel="prefetch" href="/assets/js/47.6ac72fe6.js"><link rel="prefetch" href="/assets/js/48.e074c7a0.js"><link rel="prefetch" href="/assets/js/49.2739bb01.js"><link rel="prefetch" href="/assets/js/50.0d06e9c0.js"><link rel="prefetch" href="/assets/js/51.33d32c71.js"><link rel="prefetch" href="/assets/js/52.6f3c47c7.js"><link rel="prefetch" href="/assets/js/53.57b773d5.js"><link rel="prefetch" href="/assets/js/54.0437e35c.js"><link rel="prefetch" href="/assets/js/55.33657ea1.js"><link rel="prefetch" href="/assets/js/56.81fa3c75.js"><link rel="prefetch" href="/assets/js/57.195e8d95.js"><link rel="prefetch" href="/assets/js/58.a0082d65.js"><link rel="prefetch" href="/assets/js/59.59349f31.js"><link rel="prefetch" href="/assets/js/60.3b426f4e.js"><link rel="prefetch" href="/assets/js/61.f20aa314.js"><link rel="prefetch" href="/assets/js/62.c6c0ac61.js"><link rel="prefetch" href="/assets/js/63.5a277c2e.js"><link rel="prefetch" href="/assets/js/64.f7df860b.js"><link rel="prefetch" href="/assets/js/65.38cc88cb.js"><link rel="prefetch" href="/assets/js/66.30b92094.js"><link rel="prefetch" href="/assets/js/67.79799a66.js"><link rel="prefetch" href="/assets/js/68.2cadcce1.js"><link rel="prefetch" href="/assets/js/69.4f1ea3ad.js"><link rel="prefetch" href="/assets/js/70.8e3c575d.js"><link rel="prefetch" href="/assets/js/71.bfd02c7e.js"><link rel="prefetch" href="/assets/js/72.a52d3a2c.js"><link rel="prefetch" href="/assets/js/73.c5c52cfe.js"><link rel="prefetch" href="/assets/js/74.b84a9a4d.js"><link rel="prefetch" href="/assets/js/75.b7d7e41d.js"><link rel="prefetch" href="/assets/js/76.a3ff3151.js"><link rel="prefetch" href="/assets/js/77.9bc789b7.js"><link rel="prefetch" href="/assets/js/78.3dafd143.js"><link rel="prefetch" href="/assets/js/79.a472ce98.js"><link rel="prefetch" href="/assets/js/80.43259302.js"><link rel="prefetch" href="/assets/js/81.1c815beb.js"><link rel="prefetch" href="/assets/js/82.e1b18d22.js"><link rel="prefetch" href="/assets/js/83.489b306c.js"><link rel="prefetch" href="/assets/js/84.8d777607.js"><link rel="prefetch" href="/assets/js/86.b0a9be3e.js"><link rel="prefetch" href="/assets/js/87.e8d38dd7.js"><link rel="prefetch" href="/assets/js/88.36f643e9.js"><link rel="prefetch" href="/assets/js/89.4bd47103.js"><link rel="prefetch" href="/assets/js/90.f43a13b4.js"><link rel="prefetch" href="/assets/js/91.1b4cc55b.js"><link rel="prefetch" href="/assets/js/92.75396ec1.js"><link rel="prefetch" href="/assets/js/93.9376e7f5.js"><link rel="prefetch" href="/assets/js/94.1f7792b8.js"><link rel="prefetch" href="/assets/js/95.1db8dc92.js"><link rel="prefetch" href="/assets/js/96.e983681a.js"><link rel="prefetch" href="/assets/js/97.3e18769a.js"><link rel="prefetch" href="/assets/js/98.1c64c805.js"><link rel="prefetch" href="/assets/js/99.1404c2c7.js"><link rel="prefetch" href="/assets/js/100.d22d6942.js"><link rel="prefetch" href="/assets/js/101.18066a5f.js"><link rel="prefetch" href="/assets/js/102.3a76998d.js"><link rel="prefetch" href="/assets/js/103.f0b17271.js"><link rel="prefetch" href="/assets/js/104.b8e67d03.js"><link rel="prefetch" href="/assets/js/105.ff873bd8.js"><link rel="prefetch" href="/assets/js/106.4d912bb0.js"><link rel="prefetch" href="/assets/js/107.be364bc5.js"><link rel="prefetch" href="/assets/js/108.c574492c.js"><link rel="prefetch" href="/assets/js/109.8dad8309.js"><link rel="prefetch" href="/assets/js/110.4338edbc.js"><link rel="prefetch" href="/assets/js/111.78923cd4.js"><link rel="prefetch" href="/assets/js/112.d5c9e7b0.js"><link rel="prefetch" href="/assets/js/113.75d3411f.js"><link rel="prefetch" href="/assets/js/114.5428d03c.js"><link rel="prefetch" href="/assets/js/115.f0cb32ca.js"><link rel="prefetch" href="/assets/js/116.396d5bf6.js"><link rel="prefetch" href="/assets/js/117.eba8ac2e.js"><link rel="prefetch" href="/assets/js/118.80949d16.js"><link rel="prefetch" href="/assets/js/119.374fb448.js"><link rel="prefetch" href="/assets/js/120.9a2042d2.js"><link rel="prefetch" href="/assets/js/121.370ff5ae.js"><link rel="prefetch" href="/assets/js/122.4ff25e3d.js"><link rel="prefetch" href="/assets/js/123.b3408294.js"><link rel="prefetch" href="/assets/js/124.f49ebfb6.js"><link rel="prefetch" href="/assets/js/125.c59f8dff.js"><link rel="prefetch" href="/assets/js/126.af0282c9.js"><link rel="prefetch" href="/assets/js/127.472fbe60.js"><link rel="prefetch" href="/assets/js/128.10a68733.js"><link rel="prefetch" href="/assets/js/129.9332cc80.js"><link rel="prefetch" href="/assets/js/130.89cdea63.js"><link rel="prefetch" href="/assets/js/131.14d905e7.js"><link rel="prefetch" href="/assets/js/132.0c623eb3.js"><link rel="prefetch" href="/assets/js/133.7b0d8ae6.js"><link rel="prefetch" href="/assets/js/134.231d2491.js"><link rel="prefetch" href="/assets/js/135.40cdb4e8.js"><link rel="prefetch" href="/assets/js/136.1d3e715a.js"><link rel="prefetch" href="/assets/js/137.49bbc17c.js"><link rel="prefetch" href="/assets/js/138.c5169e24.js"><link rel="prefetch" href="/assets/js/139.054b69b7.js"><link rel="prefetch" href="/assets/js/140.8dbbb57f.js"><link rel="prefetch" href="/assets/js/141.6e65a485.js"><link rel="prefetch" href="/assets/js/142.9bad7827.js"><link rel="prefetch" href="/assets/js/143.e3225628.js"><link rel="prefetch" href="/assets/js/144.5a85983c.js"><link rel="prefetch" href="/assets/js/145.0f87905c.js"><link rel="prefetch" href="/assets/js/146.c1756e66.js"><link rel="prefetch" href="/assets/js/147.cbf7d45e.js"><link rel="prefetch" href="/assets/js/148.e89580bb.js"><link rel="prefetch" href="/assets/js/149.7ac5a7fe.js"><link rel="prefetch" href="/assets/js/150.c4557cdb.js"><link rel="prefetch" href="/assets/js/151.8c90de9b.js"><link rel="prefetch" href="/assets/js/152.688914d9.js"><link rel="prefetch" href="/assets/js/153.570638d0.js"><link rel="prefetch" href="/assets/js/154.4b875c34.js"><link rel="prefetch" href="/assets/js/155.22dfc4b6.js"><link rel="prefetch" href="/assets/js/156.a3dc9edf.js"><link rel="prefetch" href="/assets/js/157.e2857678.js"><link rel="prefetch" href="/assets/js/158.d6f09397.js"><link rel="prefetch" href="/assets/js/159.78267aec.js"><link rel="prefetch" href="/assets/js/160.dc9b9485.js"><link rel="prefetch" href="/assets/js/161.775aa36b.js"><link rel="prefetch" href="/assets/js/162.c706b76e.js"><link rel="prefetch" href="/assets/js/163.7d8cf635.js"><link rel="prefetch" href="/assets/js/164.8ac3abd7.js"><link rel="prefetch" href="/assets/js/165.17b3cd24.js"><link rel="prefetch" href="/assets/js/166.bfa3e920.js"><link rel="prefetch" href="/assets/js/167.32f026e7.js"><link rel="prefetch" href="/assets/js/168.aa92157f.js"><link rel="prefetch" href="/assets/js/169.f9af9f69.js"><link rel="prefetch" href="/assets/js/170.d4672036.js"><link rel="prefetch" href="/assets/js/171.6aa5c7ea.js"><link rel="prefetch" href="/assets/js/172.cf2f2f2f.js"><link rel="prefetch" href="/assets/js/173.5f148dab.js"><link rel="prefetch" href="/assets/js/174.1a8520d1.js"><link rel="prefetch" href="/assets/js/175.5d32257e.js"><link rel="prefetch" href="/assets/js/176.6821d125.js"><link rel="prefetch" href="/assets/js/177.90a5e6af.js"><link rel="prefetch" href="/assets/js/178.c8fd37fe.js"><link rel="prefetch" href="/assets/js/179.4089ebb4.js"><link rel="prefetch" href="/assets/js/180.f69436b6.js"><link rel="prefetch" href="/assets/js/181.26c35c46.js"><link rel="prefetch" href="/assets/js/182.0b7681ef.js"><link rel="prefetch" href="/assets/js/183.12ffe68f.js"><link rel="prefetch" href="/assets/js/184.cb83e8bb.js">
    <link rel="stylesheet" href="/assets/css/185.styles.15a58fe7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      思维发散
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><!----></div></header><div class="sidebar-mask"></div><div class="sidebar"><!----><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>基础</span><!----></p><ul class="sidebar-group-items"><li><a href="/basis/dataType.html" class="sidebar-link">数据类型</a></li><li><a href="/basis/code-literacy.html" class="sidebar-link">代码素养</a></li><li><a href="/basis/fav-link.html" class="sidebar-link">收藏文章</a></li><li><a href="/basis/fav-blog.html" class="sidebar-link">JS干货</a></li><li><a href="/basis/js-knotty.html" class="sidebar-link">JS疑难知识点</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>高级</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>手写代码</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>原理</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>css</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>浏览器</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>组件封装</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>项目经验</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>react</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>vue</span><span class="arrow down"></span></p><ul class="sidebar-group-items"><li><a href="/vue/vue-all.html" class="active sidebar-link">vue知识汇总</a></li><li><a href="/vue/vue-eslint.html" class="sidebar-link">Vue eslint配置</a></li><li><a href="/vue/vue-framework.html" class="sidebar-link">Vue 架构</a></li><li><a href="/vue/vue.html" class="sidebar-link">Vue 小技巧</a></li><li><a href="/vue/vue-life.html" class="sidebar-link">Vue生命周期</a></li><li><a href="/vue/vue-nextTick.html" class="sidebar-link">nextTick原理分析</a></li><li><a href="/vue/vue-point1.html" class="sidebar-link">Vue 知识点1</a></li><li><a href="/vue/vue-transition.html" class="sidebar-link">Vue-transition动画原理</a></li><li><a href="/vue/keep-alive.html" class="sidebar-link">keep-alive原理</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>nodejs</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>webpack</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>性能优化</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>web安全</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>算法</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>协作</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>后端</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>M</span><span class="arrow right"></span></p><!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>练习</span><span class="arrow right"></span></p><!----></div></li></ul></div><div class="page"><div class="content"><h2 id="vue知识汇总"><a href="#vue知识汇总" aria-hidden="true" class="header-anchor">#</a> vue知识汇总</h2><ol><li><a href="#life">聊聊vue的生命周期（new Vue()做了什么）</a></li><li><a href="#defineprototype">聊聊vue的数据双向绑定</a></li><li><a href="nextTick">nextTick原理是什么</a></li><li><a href="message">vue组件通信方式有哪些</a></li><li><a href="vdom">聊聊vue中的virtualdom</a></li><li><a href="transition">vue-transition动画原理</a></li><li><a href="keepalive">keep-alive的原理</a></li><li><a href="computed&watch">computed 和 watch区别</a></li><li><a href="arr&obj">vue数组/对象更新 视图不更新的原因？</a></li><li><a href="if&for">v-if和v-for谁的优先级更高</a></li><li><a href="scoped">组件样式不生效的原因</a></li><li><a href="vex">谈谈vuex的理解</a></li><li><a href="vdomQuick">Virtual DOM 真的比操作原生 DOM 快吗？谈谈你的想法。</a></li><li><a href="vuexAsync">为什么 Vuex 的 mutation 和 Redux 的 reducer 中不能做异步操作？</a></li><li><a href="if&show">v-if 和 v-show 指令有什么相同和不同</a></li><li><a href="class">动态绑定class的方法</a></li><li><a href="datastram">怎样理解单向数据流</a></li><li><a href="vmodel">自定义组件的语法糖 v-model 是怎样实现的</a></li><li><a href="routerHook">vue-router 有哪几种导航钩子</a></li><li><a href="render">理解Vue中的Render渲染函数</a></li><li><a href="slot"> slot插槽</a></li><li><a href="func"> 组件中data为什么是函数</a></li></ol><ul><li><p id="life">聊聊vue的生命周期</p>
生命周期函数就是组件在初始化或者数据更新时会触发的钩子函数。 在初始化时，会调用以下代码，生命周期就是通过 callHook 调用的
</li></ul><div class="language-js extra-class"><pre class="language-js"><code>Vue<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//  建立父子组件关系，在当前实例上添加一些属性和生命周期标识。如：$children、$refs、_isMounted等。</span>
  <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token comment">// 用来存放除@hook:生命周期钩子名称=&quot;绑定的函数&quot;事件的对象。如：$on、$emit等。</span>
  <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> 
  <span class="token comment">// 用于初始化$slots、$attrs、$listeners</span>
  <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> 
  <span class="token comment">// 拿不到 props data</span>
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span> 
  <span class="token comment">// 初始化inject，一般用于更深层次的组件通信，相当于加强版子组件的props。用于组件库开发较多</span>
  <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>  
  <span class="token comment">// 是很多选项初始化的汇总，包括：props、methods、data、computed 和 watch 等。</span>
  <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> 
  <span class="token comment">//初始化provide</span>
  <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> 
  <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
  <span class="token comment">// 挂载实例</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    vm<span class="token punctuation">.</span><span class="token function">$mount</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$options<span class="token punctuation">.</span>el<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以发现在以上代码中，beforeCreate 调用的时候，是获取不到 props 或者 data 中的数据的，因为这些数据的初始化都在 initState 中。 接下来会执行挂载函数</p><ul><li><p id="defineprototype">聊聊vue的数据双向绑定</p></li></ul><blockquote><p>核心的 API 是通过 Object.defineProperty() 来劫持各个属性的setter / getter，在数据变动时发布消息给订阅者，触发相应的监听回调</p></blockquote><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//##################step6-订阅-观察者模式#######################</span>
		<span class="token comment">/**
		构造函数
		属性是subs
		原型链上有2个方法 添加和提示
		*/</span>
		<span class="token keyword">function</span> <span class="token function">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		Dep<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
			addSub<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			notify<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span><span class="token punctuation">{</span>
					sub<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'sub'</span><span class="token punctuation">,</span> sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">Wathcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> node<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
			Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>node <span class="token operator">=</span> node<span class="token punctuation">;</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>vm <span class="token operator">=</span> vm<span class="token punctuation">;</span>	
			<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		Wathcher<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span>
			update<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>node<span class="token punctuation">.</span>nodeValue <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'get---name'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>vm<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">observe</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">{</span>
			Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 循环对象得到key数组，循环执行</span>
				<span class="token function">defineReactive</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> key<span class="token punctuation">,</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将属性挂载到vm上而不是data里</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// obj 是vm， 和observe里的obj不一样</span>
			<span class="token keyword">var</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 类似于公众号官方， 每一个属性都是一个公众号</span>
			Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
				<span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span><span class="token punctuation">{</span>
						dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token comment">// watcher 实例</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">return</span> val<span class="token punctuation">;</span> <span class="token comment">// 很重要，不然vm中的该属性没有值</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token keyword">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newVal<span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>val <span class="token operator">===</span> newVal<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
					val <span class="token operator">=</span> newVal<span class="token punctuation">;</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'dep'</span><span class="token punctuation">,</span> dep<span class="token punctuation">)</span><span class="token punctuation">;</span>
					dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">compile</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// console.log('vm-compile', vm);</span>
			<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex">/\{\{(.*)\}\}/</span><span class="token punctuation">;</span> <span class="token comment">// 括号里为分组</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">var</span> attr <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes<span class="token punctuation">;</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span> attr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>attr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName<span class="token operator">=</span><span class="token string">&quot;v-model&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
						<span class="token keyword">var</span> name <span class="token operator">=</span> attr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue<span class="token punctuation">;</span>
						node<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
							vm<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
						node<span class="token punctuation">.</span>value <span class="token operator">=</span> vm<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 可输入表单类型 值是value</span>
						node<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token string">'v-model'</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>nodeValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
					<span class="token keyword">var</span> name <span class="token operator">=</span> RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 第一个分组值</span>
					name <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// node.nodeValue = vm[name]; // 文本类型 值为nodeValue</span>
					<span class="token keyword">new</span> <span class="token class-name">Wathcher</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> node<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">nodeToFragment</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">var</span> flag <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> child<span class="token punctuation">;</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span>child <span class="token operator">=</span> node<span class="token punctuation">.</span>firstChild<span class="token punctuation">)</span><span class="token punctuation">{</span>
				<span class="token comment">// 经过compile之后 node不包含 v-model 及 {{}}</span>
				<span class="token function">compile</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">;</span>
				flag<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> flag<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">Vue</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
			<span class="token keyword">var</span> id <span class="token operator">=</span> options<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
			<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">;</span>
			<span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 监听data中的每个属性</span>
			<span class="token keyword">var</span> dom <span class="token operator">=</span> <span class="token function">nodeToFragment</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
			el<span class="token punctuation">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
			data<span class="token punctuation">:</span> <span class="token punctuation">{</span>
				text<span class="token punctuation">:</span> <span class="token string">'hello defineProperty'</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>-</p><p id="nextTick">nextTick原理是什么</p>
利用事件循环机制，通过promise、MutationObserver、settimeout等选择一种方式将要执行的回调函数在DOM更新之后执行<p></p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> nextTick <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> callbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">let</span> pending <span class="token operator">=</span> <span class="token boolean">false</span>
  <span class="token keyword">let</span> timerFunc

  <span class="token keyword">function</span> <span class="token function">nextTickHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    pending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     之所以要slice复制一份出来是因为有的cb执行过程中又会往callbacks中加入内容，比如$nextTick的回调函数里又有$nextTick，
     那么这些应该放入到下一个轮次的nextTick去执行，所以拷贝一份，遍历完成即可，防止一直循环下去。
     */</span>
    <span class="token keyword">const</span> copies <span class="token operator">=</span> callbacks<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    callbacks<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> copies<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      copies<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*
  nextTick行为利用了microtask队列, 先使用 Promise.resolve().then(nextTickHandler)来将异步回调
  放入到microtask中，Promise 和 MutationObserver都可以使用，但是 MutationObserver 在IOS9.3以上的
  WebView中有bug，因此如果满足第一项的话就可以执行，如果没有原生Promise就用 MutationObserver。
  */</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNative</span><span class="token punctuation">(</span>Promise<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> p <span class="token operator">=</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">var</span> <span class="token function-variable function">logError</span> <span class="token operator">=</span> err <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      p<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">catch</span><span class="token punctuation">(</span>logError<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>isIOS<span class="token punctuation">)</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span>noop<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> MutationObserver <span class="token operator">!==</span> <span class="token string">'undefined'</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
    <span class="token function">isNative</span><span class="token punctuation">(</span>MutationObserver<span class="token punctuation">)</span> <span class="token operator">||</span>
    <span class="token comment">// PhantomJS and iOS 7.x</span>
    MutationObserver<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object MutationObserverConstructor]'</span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// use MutationObserver where native Promise is not available,</span>
    <span class="token comment">// e.g. PhantomJS IE11, iOS7, Android 4.4</span>
    <span class="token comment">/*
     创建一个MutationObserver，observe监听到DOM改动之后执行的回调 nextTickHandler 
     */</span>
    <span class="token keyword">var</span> counter <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">var</span> observer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MutationObserver</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">)</span>
    <span class="token keyword">var</span> textNode <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span><span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 使用MutationObserver的接口，监听文本节点的字符内容</span>
    observer<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span>textNode<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      characterData<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     每次执行timerFunc函数都会让文本节点的内容在0/1之间切换，切换之后将新赋值到那个我们MutationObserver监听的文本节点上去。
     */</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      counter <span class="token operator">=</span> <span class="token punctuation">(</span>counter <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span>
      textNode<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>counter<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// fallback to setTimeout</span>
    <span class="token comment">/*
     如果上面的两种都不支持的话，我们就使用setTimeout来执行
     */</span>
    <span class="token function-variable function">timerFunc</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span>nextTickHandler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">queueNextTick</span><span class="token punctuation">(</span>cb<span class="token operator">?</span><span class="token punctuation">:</span> Function<span class="token punctuation">,</span> ctx<span class="token operator">?</span><span class="token punctuation">:</span> Object<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> _resolve
    callbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>cb<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
          cb<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">handleError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> ctx<span class="token punctuation">,</span> <span class="token string">'nextTick'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_resolve<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">_resolve</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* 如果pending为true，表明本轮事件循环中已经执行过 timerFunc(nextTickHandler, 0) */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pending<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      pending <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token function">timerFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> Promise <span class="token operator">!==</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        _resolve <span class="token operator">=</span> resolve
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><p id="message">vue组件通信方式有哪些</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>1. props
2. $attrs/$listeners
3. 依赖注入provide inject
4. ref、parent、children
5. emit on off
6. eventbus
7. vuex
</code></pre></div><p><a href="https://juejin.im/post/5c776ee4f265da2da53edfad" target="_blank" rel="noopener noreferrer">参考<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p><ul><li><p id="vdom">聊聊vue中的virtualdom</p></li></ul><ol><li>创建虚拟DOM</li><li>渲染虚拟DOM</li><li>调用render方法将虚拟DOM转化成真实DOM</li><li>DOM-diff比较两个虚拟DOM的区别，也就是在比较两个对象的区别。</li><li>比较规则</li></ol><ul><li>新的DOM节点不存在{type: 'REMOVE', index}</li><li>文本的变化{type: 'TEXT', text: 1}</li><li>当节点类型相同时，去看一下属性是否相同，产生一个属性的补丁包{type: 'ATTR', attr: {class: 'list-group'}}</li><li>节点类型不相同，直接采用替换模式{type: 'REPLACE', newNode}</li></ul><ol start="6"><li>patch补丁更新</li></ol><ul><li>属性ATTR
for in去遍历attrs对象，当前的key值如果存在，就直接设置属性setAttr； 如果不存在对应的key值那就直接删除这个key键的属性</li><li>文字TEXT
直接将补丁的text赋值给node节点的textContent即可</li><li>替换REPLACE
新节点替换老节点，需要先判断新节点是不是Element的实例，是的话调用render方法渲染新节点；
不是的话就表明新节点是个文本节点，直接创建一个文本节点就OK了。
之后再通过调用父级parentNode的replaceChild方法替换为新的节点</li><li>删除REMOVE
直接调用父级的removeChild方法删除该节点</li></ul><div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">import</span> <span class="token punctuation">{</span> createElement<span class="token punctuation">,</span> render<span class="token punctuation">,</span> renderDom <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./element'</span><span class="token punctuation">;</span>
<span class="token comment">// +++ 引入diff和patch方法</span>
<span class="token keyword">import</span> diff <span class="token keyword">from</span> <span class="token string">'./diff'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> patch <span class="token keyword">from</span> <span class="token string">'./patch'</span><span class="token punctuation">;</span>
<span class="token comment">// +++</span>

<span class="token keyword">let</span> virtualDom <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'list'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'周杰伦'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'林俊杰'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'王力宏'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> el <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>virtualDom<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">renderDom</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> window<span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// +++</span>
<span class="token comment">// 创建另一个新的虚拟DOM</span>
<span class="token keyword">let</span> virtualDom2 <span class="token operator">=</span> <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'list-group'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item active'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'七里香'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'一千年以后'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'item'</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'需要人陪'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// diff一下两个不同的虚拟DOM</span>
<span class="token keyword">let</span> patches <span class="token operator">=</span> <span class="token function">diff</span><span class="token punctuation">(</span>virtualDom<span class="token punctuation">,</span> virtualDom2<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>patches<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 将变化打补丁，更新到el</span>
<span class="token function">patch</span><span class="token punctuation">(</span>el<span class="token punctuation">,</span> patches<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><p id="transition">vue-transition动画原理</p></li></ul><ol><li>插入dom时，添加ade-enter、fade-enter-active样式，生效</li><li>fade-enter-active，fade-leave-active在动画消失后移除</li><li>利用requestAnimationFrame在下一帧删除fade-enter样式</li></ol><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
  <span class="token selector">.fade-enter-active, .fade-leave-active</span> <span class="token punctuation">{</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> opacity .5s
  <span class="token punctuation">}</span>
  <span class="token selector">.fade-enter, .fade-leave-to</span> <span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name"><span class="token namespace">v-on:</span>click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show = !show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    Toggle
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transition</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>fade<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>show<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>hello<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transition</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li><p id="keepalive">keep-alive的原理</p></li></ul><p>keep-alive 是 Vue.js 的一个内置组件。它能够不活动的组件实例保存在内存中，而不是直接将其销毁，它是一个抽象组件，不会被渲染到真实 DOM 中，也不会出现在父组件链中。</p><p>它提供了 include 与 exclude 两个属性，允许组件有条件地进行缓存。</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive exclude<span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>component<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>keep<span class="token operator">-</span>alive include<span class="token operator">=</span><span class="token string">&quot;a&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>component<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>component<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>keep<span class="token operator">-</span>alive<span class="token operator">&gt;</span>
</code></pre></div><ol><li><p>keep-alive 提供了两个生命钩子，分别是 activated 与 deactivated。<br>
因为 keep-alive 会将组件保存在内存中，并不会销毁以及重新创建，所以不会重新调用组件的 created 等方法，需要用 activated 与 deactivated 这两个生命钩子来得知当前组件是否处于活动状态。</p></li><li><p>created 钩子会创建一个 cache 对象，用来作为缓存容器，保存 vnode 节点。 遍历 cache 中的所有项，如果不符合 filter 指定的规则的话，则会执行 pruneCacheEntry。pruneCacheEntry 则会调用组件实例的$destroy 方法来将组件销毁。</p></li><li><p>Vue.js 内部将 DOM 节点抽象成了一个个的VNode 节点，keep-alive 组件的缓存也是基于 VNode 节点的而不是直接存储 DOM 结构。它将满足条件（ pruneCache 与 pruneCache ）的组件在 cache 对象中缓存起来，在需要重新渲染的时候再将 vnode 节点从 cache 对象中取出并渲染。</p></li></ol><ul><li><p id="computed&watch">computed 和 watch、methods区别</p></li></ul><ol><li>计算属性是自动监听依赖值的变化，从而动态返回内容，监听是一个过程，在监听的值变化时，可以触发一个回调，并做一些事情。
所以区别来源于用法，只是需要动态值，那就用计算属性；需要知道值的改变后执行业务逻辑，才用 watch，用反或混用虽然可行，但都是不正确的用法。</li><li>methods是一个方法，它可以接受参数，而computed不能，computed是可以缓存的，methods不会。</li><li>当有一些数据需要随着另外一些数据变化时，建议使用computed。 当有一个通用的响应数据变化的时候，要执行一些业务逻辑或异步操作的时候建议使用watcher</li></ol><ul><li><p id="arr&obj">vue数组/对象更新 视图不更新的原因？</p></li></ul><blockquote><p>vue检测不到数组或对象的变化，因为它的引用地址未发生变化</p></blockquote><ul><li>原因
<ol><li>数组和对象是引用型数据，直接修改里面的某个值，其引用地址并没有发生变化</li></ol></li><li>解决方法
<ol><li>this.$set(你要改变的数组/对象，你要改变的位置/key，你要改成什么value)</li><li>使用原生方法push()/pop()/shift()/unshift()等</li><li>使用filter或map返回新数组替代</li></ol></li></ul><ul><li><p id="if&for">v-if和v-for谁的优先级更高</p></li></ul><blockquote><p>v-if优先级更高， 所以不要同级使用避免重复计算</p></blockquote><ul><li><p id="scoped">组件样式不生效的原因</p></li></ul><blockquote><p>scope 不能给动态生成的样式生效，解决方法是去掉scoped</p></blockquote><ul><li><p id="vex">谈谈vuex的理解</p></li><li><p id="vdomQuick">Virtual DOM 真的比操作原生 DOM 快吗？谈谈你的想法。</p></li></ul><blockquote></blockquote><ul><li><p id="vuexAsync">为什么 Vuex 的 mutation 和 Redux 的 reducer 中不能做异步操作？</p></li><li><p id="if&show">v-if 和 v-show 指令有什么相同和不同</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>1. v-show和v-if的区别： v-show是css切换，v-if是完整的销毁和重新创建。
2. 使用 频繁切换时用v-show，运行时较少改变时用v-if
3. v-if=‘false’ v-if是条件渲染，当false的时候不会渲染
</code></pre></div><ul><li><p id="class">动态绑定class的方法</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>1. 对象方法 v-bind:class=&quot;{'orange': isRipe, 'green': isNotRipe}&quot;
2. 数组方法  v-bind:class=&quot;[class1, class2]&quot;
3. 行内 v-bind:style=&quot;{color: color, fontSize: fontSize+'px' }&quot;
</code></pre></div><ul><li><p id="datastram">怎样理解单向数据流</p></li></ul><blockquote><p>这个概念出现在组件通信。父组件是通过 prop 把数据传递到子组件的，但是这个 prop 只能由父组件修改，子组件不能修改，否则会报错。子组件想修改时，只能通过 $emit 派发一个自定义事件，父组件接收到后，由父组件修改。
一般来说，对于子组件想要更改父组件状态的场景，可以有两种方案：
在子组件的 data 中拷贝一份 prop，data 是可以修改的，但 prop 不能</p></blockquote><ul><li><p id="vmodel">自定义组件的语法糖 v-model 是怎样实现的</p></li></ul><ol><li>v-model 在模板编译的时候转换代码</li><li>v-model 本质是 :value 和 v-on，但是略微有点区别。在输入控件下，有两个事件监听，输入中文时只有当输出中文才触发数据赋值</li><li>v-model 和:bind 同时使用，前者优先级更高，如果 :value 会出现冲突</li><li>v-model 因为语法糖的原因，还可以用于父子通信</li><li></li></ol><ul><li><p id="routerHook">vue-router 有哪几种导航钩子</p></li></ul><div class="language- extra-class"><pre class="language-text"><code>&lt;router-link to='home'&gt; router-link标签会渲染为&lt;a&gt;标签，咋填template中的跳转都是这种；
另一种是编程是导航 也就是通过js跳转 比如 router.push('/home')
</code></pre></div><ul><li><p id="render">理解Vue中的Render渲染函数</p></li></ul><blockquote><p>VUE一般使用template来创建HTML，然后在有的时候，我们需要使用javascript来创建html，这时候我们需要使用render函数。
render函数return一个createElement组件中的子元素存储在组件实列中 $slots.default 中。
return createElement('h1', this.title); createElement返回的是包含的信息会告诉VUE页面上需要渲染什么样的节点及其子节点。我们称这样的节点为虚拟DOM，可以简写为VNode</p></blockquote><ul><li><p id="slot"> slot插槽</p></li></ul><ol><li>单个插槽<br>
当子组件模板只有一个没有属性的插槽时，父组件传入的整个内容片段将插入到插槽所在的 DOM 位置，并替换掉插槽标签本身。
最初在  标签中的任何内容都被视为备用内容。备用内容在子组件的作用域内编译，并且只有在宿主元素为空，且没有要插入的内容时才显示备用内容。</li><li>命名插槽<br>
solt元素可以用一个特殊的特性name来进一步配置如何分发内容。多个插槽可以有不同的名字。
这样可以将父组件模板中 slot 位置，和子组件 slot 元素产生关联，便于插槽内容对应传递</li><li>作用域插槽scoped slots<br>
可以访问组件内部数据的可复用插槽(reusable slot)
在父级中，具有特殊特性 slot-scope 的 元素必须存在，表示它是作用域插槽的模板。slot-scope 的值将被用作一个临时变量名，此变量接收从子组件传递过来的 prop 对象。</li></ol><ul><li><p id="func">组件中data为什么是函数</p></li></ul><blockquote><p>因为组件是用来复用的，JS 里对象是引用关系，这样作用域没有隔离，而 new Vue 的实例，是不会被复用的，因此不存在引用对象的问题。</p></blockquote></div><div class="content edit-link"><!----><!----></div><div class="content page-nav"><p class="inner"><span class="prev">
        ← <a href="/react/react-fiber.html" class="prev">
          react-fiber机制
        </a></span><span class="next"><a href="/vue/vue-eslint.html">
          Vue eslint配置
        </a> →
      </span></p></div></div></div></div>
    <script src="/assets/js/31.f2b58b01.js" defer></script><script src="/assets/js/app.6f74513f.js" defer></script>
  </body>
</html>
